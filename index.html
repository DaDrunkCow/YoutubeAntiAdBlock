<!DOCTYPE html>
<html>
<head>
    <title>YOUTUBE WILL LOSE</title>
    <style>
        body
        {
            background-color:rgb(15,15,15);
            overflow:hidden;
            margin:0px;
            padding:0px;
            padding-right:20px;
        }
        .wholeContainer
        {
            display:grid;
            grid-template-rows:2fr 25fr;
            gap:20px;
            width:100%;
            height:100%;
        }
        .inputContainer
        {
            display:grid;
            grid-template-columns:10fr 1fr;
            gap:10px;
            width:100%;
            height:100%;
            padding:10px;
        }
        .theBestFont
        {
            font-family:monospace;
            font-size:large;
            color:white;
        }
        input[type=text]
        {
            
            background-color:rgb(18,18,18);
            border-width:2px;
            border-color:rgb(48,48,48);
            border-radius:5px;
            padding-top:5px;
            padding-bottom:5px;
            padding-left:13px;
            padding-right:13px;
        }
        button
        {
            background-color:rgb(34,34,34);
            border-width:2px;
            border-color:rgb(48,48,48);
            border-radius:5px;
            padding-top:5px;
            padding-bottom:5px;
            padding-left:13px;
            padding-right:13px;
        }
        button:hover
        {
            background-color:rgb(41,41,41);
        }
        iframe
        {
            border-width:0px;
            width:100%;
            height:100%;
            /* TODO: make border-radius work on iframe */
        }
    </style>
</head>
<body>
    <div class="wholeContainer">
        <div class="inputContainer">
            <input id="link" name="link" type="text" class="theBestFont" placeholder="Youtube url...">
            <button id="push" class="theBestFont" onclick="changeVideo()">Watch</button>
        </div>
        <iframe id="video" src="" style="padding-left:10px;" allow="fullscreen;"></iframe>
    </div>
</body>
</html>

<script>
    // changes iframe video src to parameter url
    document.getElementById("video").src = fillURL(getURLParameter("url"));

    // listens to enter key presses on input field
    document.getElementById("link").addEventListener("keypress", function(e)
    {
        if (e.keyCode === 13)
        {
            e.preventDefault();
            document.getElementById("push").click();
        }
    });

    /**
     * gets value with indicated key parameter
     * @param key String
     * @return undefined null String
     */
    function getURLParameter (key)
    {
        let url = window.location.href.split("?")[1];
        if (url === undefined || url === null)
        {
            return null;
        }
        url = url.split('&');
        for (let i = 0; i < url.length; i++)
        {
            let data = url[i].split('=');
            if (data[0] == key)
            {
                return data[1]; 
            }
        }
    }

    /**
     * extracts url from youtube link
     * @param str String
     * @return String
     */
    function extractURL (str)
    {
        let a = null;
        let b = null;
        for (let i = 0; i < str.length; i++)
        {
            if (a == null && str.charAt(i) == '=')
            {
                a = i;
            }
            if (b == null && str.charAt(i) == '&')
            {
                b = i;
            }
        }
        return str.slice(a + 1, (b != null) ? b : str.length);
    }

    /**
     * function that plays when button or enter is pressed
     */
    function changeVideo ()
    {
        // console.log(window.location.href);
        
        // const URL_START = "https://www.youtube.com/embed/";
        const URL_START = "https://dadrunkcow.github.io/YoutubeAntiAdBlock/?url=";
        let str = document.getElementById("link").value;
        /*
         * scroll from left to right until first '=' 
         * stop at first '&'
         */
        let data = extractURL(str);
        // console.log(data);
        location.href = URL_START.concat(data)
        // document.getElementById("video").src = URL_START.concat(data);
    }

    /**
     * modifies parameter url with specific values
     * @param str String
     * @return String
     */
    function fillURL (str)
    {
        if (str === null)
        {
            return "";
        }
        const URL_START = "https://www.youtube.com/embed/";
        return URL_START.concat(str);
    }

</script>